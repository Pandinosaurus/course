<!DOCTYPE html>
<html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>QPython的WebApp</title>
<link rel="stylesheet" href="../../static/style.css" type="text/css" />
<link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<link href="http://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<script src="http://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</head>
<body>
<div class="header doc-header web-show">
<div class="col-sm-offset-2 col-sm-8  index-header">
<div class="navbar-header">
<button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#example-navbar-collapse">
<span class="sr-only">切换导航</span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
<span class="icon-bar"></span>
</button>
<a href="/index.html" class="logo"><img src="http://www.qpython.org/static/img_logo.png"></a>
</div>
<ul class="header-title collapse navbar-collapse" id="example-navbar-collapse" >
<li>
<a href="http://www.qpython.org/index.html">Home</a>
</li>
<li>
<a href="http://www.qpython.org/document.html">Guide</a>
</li>
<li class="header-phone-selected">
<a href="/index.html" class="header-selected">Course</a>
<span class="header-title-selected"></span>
</li>
<li>
<a href="http://www.aipy.org">AIPY</a>
</li>
<li>
<a target="_blank" href="https://github.com/qpython-android/qpython">Github</a>
</li>
</ul>
<div class="search-box hidden-xs">
<form action="search.html">
<input type="search" name="q" placeholder="keyword">
<input type="hidden" name="check_keywords" value="yes" />
<input type="hidden" name="area" value="default" />
<button><img src="http://www.qpython.org/static/ic_search.png"></button>
</form>
</div>
</div>
</div>
<main class="contain web-content">
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="qpythonwebapp">
<h1>QPython的WebApp<a class="headerlink" href="#qpythonwebapp" title="Permalink to this headline">¶</a></h1>
<p>WebApp是一种Web开发者能够快速上手开发的应用，QPython的WebApp支持常见WebAApp的优势。此外，QPython让手机本身就能成为WebApp的运行容器，支持处理复杂的程序逻辑，因此能极大地提高WebApp使用体验，同时也增加了开发的灵活度。</p>
<div class="section" id="webapp">
<h2>WebApp声明<a class="headerlink" href="#webapp" title="Permalink to this headline">¶</a></h2>
<p>在QPython中，通过头部声明来区分程序类型，当头部有以下定义时，我们知道它是一个WebApp程序。</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#qpy:webapp:&lt;WebApp程序名称&gt;</span>
<span class="c1">#qpy://&lt;WebApp运行所在的IP，一般为127.0.0.1&gt;:&lt;WebApp运行所在的端口&gt;/&lt;初次载入时对应的WebApp Url路径&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="id1">
<h2>WebApp运行流程<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>在程序被识别为WebApp运行后，QPython会让程序作为后台服务的方式启动，同时在前端会启动一个WebView组件，载入你在程序头部声明所对应的URL（由IP、端口、URL路径组合而成）</p>
<p>如，如果IP为127.0.0.1，端口为8080，URL路径为hello/test，则WebView载入的URL为：<a class="reference external" href="http://127.0.0.1:8080/hello/test">http://127.0.0.1:8080/hello/test</a></p>
</div>
<div class="section" id="id2">
<h2>WebApp退出原理<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>当你点了后退键退出WebView时，WebApp后台进程也需要退出，由于一开始QPython让其按照后台服务的方式启动，所以我们需要通知其退出，QPython是在WebView退出时，发出一个http://IP:端口/__exit 的GET请求到后台服务，由其处理结束后台进程，退出服务的工作，因此，作为一个完成的流程，您需要在自己的WebApp中定义/__exit 对应的退出服务操作，我们在结尾示例中附有示例。</p>
</div>
<div class="section" id="id3">
<h2>例子<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>作为QPython内嵌的Web开发库，来看一个最简单的bottle的Hello world</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>#qpy:webapp:Bottle Sample
#qpy://127.0.0.1:8080/hello/qpython
from bottle import route, run, template
@route(&#39;/hello/&lt;name&gt;&#39;)
def index(name):
    return template(&#39;&lt;b&gt;Hello {{name}}&lt;/b&gt;!&#39;, name=name)
@route(&#39;/__exit&#39;)
def exit():
    import os,signal
    os.kill(os.getpid(), signal.SIGKILL)
run(host=&#39;127.0.0.1&#39;, port=8080)
</pre></div>
</div>
<button class="button">Run …</button>
<p>点击运行，将代码复制到编辑器中点击运行即可看见效果。</p>
<p>当然，在QPython中，还提供了其他Web开发框架的支持来帮助你简化工作。</p>
</div>
</div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
</main>
<div class="star-footer">
<img onclick="openPurchase()" src="../../static/star.jpg">
<div id="praise"><span>0</span> persons have rewarded</div>
</div>
<div class="foo"></div>
<footer class="clearfix fixfooter web-show">
<div class="col-sm-offset-2 col-sm-6 footer-div1">
<div class="footer-block-item">
<span class="footer-item1">Built with Sphinx using a theme provid by QPython.</span>
<span class="footer-item2 visible-xs">Copyight 2017, QPython.</span>
</div>
</div>
<div class="col-sm-2 footer-div2">
<a href="/index.html" class="pull-right"><img src="http://www.qpython.org/static/img_logo.png"></a>
</div>
</footer>
<script>
var milib;
if (milib==undefined) {
var milib = function(){
};
milib.qeditor = function(str){
alert('please open it with QPython browser')
};
milib.getPurchaseNumber = function(str){
//alert('getPurchaseNumber:'+str)
return "10+";
};
milib.a8playVideoFromGW= function(url){
window.open(url)
};
milib.qpylibinstall = function(cat,url,target){
window.open(url)
};
milib.gotoIfPay = function(url, packageId, packageUrl){
window.open(url)
};
} else {
}
function openPurchase() {
//获取标识
var u = window.location.href.split('/')
var s = u[u.length-1].replace('.html', '')
s = u[u.length-2]+'-'+s
milib.openPurchaseActivity(s)
}
//按钮事件
function btnEvent(){
var seq = this.getAttribute('target')
var a = this.parentElement.getElementsByTagName('pre')
if ( a && a.length > 0){
/**********有代码，调用控制台*************/
var code = a[seq].lastChild.nodeValue
milib.qeditor(code)
}else{
//没有代码，调转
var url = this.getAttribute('data-url');
window.open(url);
}
}
//获取赞赏
function setPraise(){
var u = window.location.href.split('/')
var s = u[u.length-1].replace('.html', '')
s = u[u.length-2]+'-'+s
var i = document.getElementById('praise').getElementsByTagName('span')[0]
var num = milib.getPurchaseNumber(s);
i.innerHTML = num
}
//初始化代码显示
function initCode(){
var prearr = document.getElementsByTagName('pre');
for (var i = 0; i < prearr.length; i++) {
var temp_data = prearr[i].lastChild.nodeValue
//正则处理 lavel5
temp_data = temp_data.replace(/\^2\$/g, spaceString(2));
temp_data = temp_data.replace(/\^4\$/g, spaceString(4));
temp_data = temp_data.replace(/\^6\$/g, spaceString(6));
temp_data = temp_data.replace(/\^8\$/g, spaceString(8));
temp_data = temp_data.replace(/\^10\$/g, spaceString(10));
temp_data = temp_data.replace(/\^12\$/g, spaceString(12));
temp_data = temp_data.replace(/\^16\$/g, spaceString(16));
temp_data = temp_data.replace(/\^20\$/g, spaceString(20));
//set
prearr[i].lastChild.nodeValue = temp_data;
}
}
//产生空格
function spaceString(num){
var v = ''
for (var i = 0; i < num; i++) {
v += ' ';
}
return v;
}
window.onload = function(){
setPraise();
initCode();
//将所有的button绑定事件
var b = document.getElementsByTagName('button');
for (var i = 0; i < b.length; i++) {
if (b[i].className=='button') {
b[i].setAttribute('target', i)
b[i].onclick = btnEvent ;
}
}
}
$(function(){
var url = location.href.split('?');
if (url.length === 2) {
var c = url[1].split('=');
if (c[1] == 'web') {
$('.web-show').css('display','block');
$('.web-content').addClass('margin-top');
}
}
})
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-103260045-3', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>