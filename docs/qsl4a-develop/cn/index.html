<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>QSL4A - QPython的安卓脚本层</title>
<link rel="stylesheet" href="../../static/style.css" type="text/css" />
<link rel="stylesheet" href="../../static/pygments.css" type="text/css" />
<script type="text/javascript">
var DOCUMENTATION_OPTIONS = {
URL_ROOT:    '../../',
VERSION:     '0.9',
COLLAPSE_INDEX: false,
FILE_SUFFIX: '.html',
HAS_SOURCE:  true
};
</script>
<script type="text/javascript" src="../../static/jquery.js"></script>
<script type="text/javascript" src="../../static/underscore.js"></script>
<script type="text/javascript" src="../../static/doctools.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
</head>
<body role="document">
<main class="contain">
<div class="document">
<div class="documentwrapper">
<div class="bodywrapper">
<div class="body" role="main">
<div class="section" id="qsl4a-qpython">
<h1>QSL4A - QPython的安卓脚本层<a class="headerlink" href="#qsl4a-qpython" title="Permalink to this headline">¶</a></h1>
<p>SL4A是Scripting Layer for Android 的缩写，中文直译为“安卓的脚本层”，QSL4A是QPython的安卓脚本层。</p>
<div class="section" id="sl4a">
<h2>什么是SL4A<a class="headerlink" href="#sl4a" title="Permalink to this headline">¶</a></h2>
<p>SL4A的全称为Scripting Layer for Android, 顾名思义就是Android的脚本架构层，它的目的就是可以用熟知的脚本开发语言来开发Android应用程序。其工作原理基于RPC远程调用，通过本地的脚本解析器和远端的原生态Android Server层的APK进行信息交互，即实现一个远程代理，把本地脚本的函数调用通过json格式的封装，传递给远程原生态Server APK进行实际的android系统函数呼叫，最后将操作的执行结果反馈给本地脚本解析器，然后再在终端显示出运行结果。</p>
<p>QPython中集成了SL4A的支持，通过SL4A，用户可以很方便地通过Python代码来调用安卓特性。</p>
</div>
<div class="section" id="qsl4a">
<h2>QSL4A支持的接口<a class="headerlink" href="#qsl4a" title="Permalink to this headline">¶</a></h2>
<p>您需要在安卓系统设置中开启QPython对应的权限设置才能使用相关的SL4A接口。</p>
<p><strong>系统应用接口</strong></p>
<ul class="simple">
<li>Android：包括剪贴板、Intent对象、广播、震动、网络状态、版本号、发送邮件、提示、输入框等在内的接口</li>
<li>应用：主要为应用管理接口</li>
<li>ActivityResult：安卓里控制ActivityResult行为的接口</li>
<li>通用Intent：访问二维码，用XX应用查看的接口</li>
</ul>
<p><strong>安卓相关设备接口</strong></p>
<ul class="simple">
<li>相机：访问&amp;调用设备的相机接口</li>
<li>联系人：联系人访问接口</li>
<li>地理位置：访问地理位置接口</li>
<li>电话：访问电话接口</li>
<li>媒体录制：能够控制录音或者视频</li>
<li>感应器管理：访问&amp;控制设备的传感器</li>
<li>设置：能够设置设备的屏幕、飞行模式、铃声模式、震动模式、音量、亮度等</li>
<li>短信：能够访问设备的短信</li>
<li>语音识别：能够识别用户的讲话并返回最可能的结果</li>
<li>音调生成器：能够由给定的电话号码生成DTMF的语音</li>
<li>唤醒锁：设备的唤醒锁接口</li>
<li>WIFI：设备的WIFI管理</li>
<li>电池管理：提供设备的电池管理接口</li>
<li>媒体播放器：媒体播放器设置</li>
<li>偏好设置：访问／控制偏好设置</li>
<li>文字语音：控制文字到语音输出</li>
<li>蓝牙：控制手机上的蓝牙设备</li>
<li>信号强度：访问手机信号强度信息</li>
<li>网络摄像头：能够控制手机的摄像机</li>
<li>用户交互界面：用于控制UI界面相关的展现，如文本对话框，密码输入框、状态栏、进度条、日期选择器等</li>
<li>NFC：NFC相关的控制，主要提供了NFC中的master/slave交换信息的方式</li>
<li>USB宿主序列：用于控制来自安卓的拥有USB主机控制器的类USB序列的设备</li>
</ul>
<p><strong>QPython相关的接口</strong></p>
<ul class="simple">
<li>QPy接口：在手机上运行QPython脚本</li>
</ul>
</div>
<div class="section" id="id1">
<h2>示例代码<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>在安卓中，可以引入androidhelper模块来载入QSL4A的支持。下面我们来运行一个简单的QSL4A脚本来体验下：</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1">#-*-coding:utf8;-*-</span>
<span class="kn">import</span> <span class="nn">androidhelper</span>
<span class="n">droid</span> <span class="o">=</span> <span class="n">androidhelper</span><span class="o">.</span><span class="n">Android</span><span class="p">()</span>
<span class="n">line</span> <span class="o">=</span> <span class="n">droid</span><span class="o">.</span><span class="n">dialogGetInput</span><span class="p">()</span>
<span class="n">s</span> <span class="o">=</span> <span class="s2">&quot;Hello, </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">result</span><span class="p">,)</span>
<span class="n">droid</span><span class="o">.</span><span class="n">makeToast</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</pre></div>
</div>
<button class="button">Run ...</button>
</div>
</div>
</div>
</div>
</div>
<div class="clearer"></div>
</div>
</main>
<footer>
<img onclick="openPurchase()" src="../../static/star.jpg">
<div id="praise"><span>0</span> persons have rewarded</div>
</footer>
<script>
var milib;
if (milib==undefined) {
var milib = function(){
};
milib.qeditor = function(str){
alert('please open it with QPython browser')
};
milib.getPurchaseNumber = function(str){
//alert('getPurchaseNumber:'+str)
return "10+";
};
milib.a8playVideoFromGW= function(url){
window.open(url)
};
milib.qpylibinstall = function(cat,url,target){
window.open(url)
};
milib.gotoIfPay = function(url, packageId, packageUrl){
window.open(url)
};
} else {
}
function openPurchase() {
//获取标识
var u = window.location.href.split('/')
var s = u[u.length-1].replace('.html', '')
s = u[u.length-2]+'-'+s
milib.openPurchaseActivity(s)
}
//按钮事件
function btnEvent(){
var seq = this.getAttribute('target')
alert(seq)
var a = this.parentElement.getElementsByTagName('pre')
if ( a && a.length > 0){
/**********有代码，调用控制台*************/
var code = a[seq].lastChild.nodeValue
milib.qeditor(code)
}else{
//没有代码，调转
var url = this.getAttribute('data-url');
window.open(url);
}
}
//获取赞赏
function setPraise(){
var u = window.location.href.split('/')
var s = u[u.length-1].replace('.html', '')
s = u[u.length-2]+'-'+s
var i = document.getElementById('praise').getElementsByTagName('span')[0]
var num = milib.getPurchaseNumber(s);
i.innerHTML = num
}
//初始化代码显示
function initCode(){
var prearr = document.getElementsByTagName('pre');
for (var i = 0; i < prearr.length; i++) {
var temp_data = prearr[i].lastChild.nodeValue
//正则处理 lavel5
temp_data = temp_data.replace(/\^2\$/g, spaceString(2));
temp_data = temp_data.replace(/\^4\$/g, spaceString(4));
temp_data = temp_data.replace(/\^6\$/g, spaceString(6));
temp_data = temp_data.replace(/\^8\$/g, spaceString(8));
temp_data = temp_data.replace(/\^10\$/g, spaceString(10));
temp_data = temp_data.replace(/\^12\$/g, spaceString(12));
temp_data = temp_data.replace(/\^16\$/g, spaceString(16));
temp_data = temp_data.replace(/\^20\$/g, spaceString(20));
//set
prearr[i].lastChild.nodeValue = temp_data;
}
}
//产生空格
function spaceString(num){
var v = ''
for (var i = 0; i < num; i++) {
v += ' ';
}
return v;
}
window.onload = function(){
setPraise();
initCode();
//将所有的button绑定事件
var b = document.getElementsByTagName('button');
for (var i = 0; i < b.length; i++) {
b[i].setAttribute('target', i)
b[i].onclick = btnEvent ;
}
}
</script>
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-103260045-3', 'auto');
ga('send', 'pageview');
</script>
</body>
</html>
